const MCVER="1.1.1",MESSG=document.getElementById("event-container"),BOARD=document.getElementsByTagName("board-container")[0],GRIDS=document.getElementsByTagName("grid"),BSCBD=document.getElementsByClassName("scoreboard")[0],WSCBD=document.getElementsByClassName("scoreboard")[1],BLKSC=document.getElementById("black-scoreboard"),WHTSC=document.getElementById("white-scoreboard"),WINBR=document.getElementById("win-banner"),ALPHA=["A","B","C","D","E","F","G","H","I","J"],NUMBR=["1","2","3","4","5","6","7","8","9","10"],MNTHS=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],CLOCK=document.getElementById("match-time");let MCHTM="00:00",PCIDS=[],PCELM,CTURN="black",SELPC=" ",BLKPT=0,WHTPT=0,BLPCS=12,WTPCS=12,GMEND=!1,firstMove=!1,stopwatch;const AGRID=document.querySelectorAll("grid.active");let OLDPARENT,target;function playSound(e,t){e=new Audio(e);null!==t&&(e.volume=t),e.play()}function sendMessage(e,t){const i=new Date;var n=i.getFullYear().toString()+" "+MNTHS[i.getUTCMonth()]+" "+i.getUTCDate().toString().padStart(2,"0")+" "+i.getUTCHours().toString().padStart(2,"0")+":"+i.getUTCMinutes().toString().padStart(2,"0")+":"+i.getUTCSeconds().toString().padStart(2,"0")+" UTC";switch(t){case"error":case"warning":case"info":case"update":MESSG.innerHTML+='<event data-ts="'+n+'" class="'+t+'">'+e.toUpperCase()+"</event>";break;default:MESSG.innerHTML+='<event data-ts="'+n+'">'+e.toUpperCase()+"</event>"}MESSG.scrollTop=MESSG.scrollHeight}function initBoard(){for(i=0;i<=64;i++)0<i&&i<=8?BOARD.innerHTML+='<grid data-row="'+ALPHA[7]+'" data-col="'+NUMBR[i-1]+'" title="Grid '+ALPHA[7]+NUMBR[i-1]+'"></grid>':8<i&&i<=16?BOARD.innerHTML+='<grid data-row="'+ALPHA[6]+'" data-col="'+NUMBR[i-9]+'" title="Grid '+ALPHA[6]+NUMBR[i-9]+'"></grid>':16<i&&i<=24?BOARD.innerHTML+='<grid data-row="'+ALPHA[5]+'" data-col="'+NUMBR[i-17]+'" title="Grid '+ALPHA[5]+NUMBR[i-17]+'"></grid>':24<i&&i<=32?BOARD.innerHTML+='<grid data-row="'+ALPHA[4]+'" data-col="'+NUMBR[i-25]+'" title="Grid '+ALPHA[4]+NUMBR[i-25]+'"></grid>':32<i&&i<=40?BOARD.innerHTML+='<grid data-row="'+ALPHA[3]+'" data-col="'+NUMBR[i-33]+'" title="Grid '+ALPHA[3]+NUMBR[i-33]+'"></grid>':40<i&&i<=48?BOARD.innerHTML+='<grid data-row="'+ALPHA[2]+'" data-col="'+NUMBR[i-41]+'" title="Grid '+ALPHA[2]+NUMBR[i-41]+'"></grid>':48<i&&i<=56?BOARD.innerHTML+='<grid data-row="'+ALPHA[1]+'" data-col="'+NUMBR[i-49]+'" title="Grid '+ALPHA[1]+NUMBR[i-49]+'"></grid>':56<i&&i<=64&&(BOARD.innerHTML+='<grid data-row="'+ALPHA[0]+'" data-col="'+NUMBR[i-57]+'" title="Grid '+ALPHA[0]+NUMBR[i-57]+'"></grid>');return console.info("Board layout initialized"),!0}function initPieces(){for(i=0;i<=GRIDS.length-1;i++){var e=GRIDS[i].attributes[0].nodeValue,t=parseInt(GRIDS[i].attributes[1].nodeValue);"H"==e&&t%2==0||"G"==e&&t%2!=0||"F"==e&&t%2==0?(GRIDS[i].innerHTML+='<piece data-ptyp="white" data-pcid="'+i+'" data-isking="false">',PCIDS.push(i),GRIDS[i].classList.add("active")):("A"==e&&t%2!=0||"B"==e&&t%2==0||"C"==e&&t%2!=0)&&(GRIDS[i].innerHTML+='<piece data-ptyp="black" data-pcid="'+i+'" data-isking="false">',PCIDS.push(i),GRIDS[i].classList.add("active"))}for(PCELM=document.getElementsByTagName("piece"),i=0;i<PCELM.length;i++)PCELM[i].setAttribute("onclick","selectPiece(this,this.attributes[1].nodeValue)");return console.info("Placed all pieces successfully"),!0}function init(){1==initBoard()&&(initPieces(),playSound("res/snd/Clack.ogg",0),playSound("res/snd/King.ogg",0),playSound("res/snd/Win.ogg",0)),document.getElementById("version").innerHTML="Version "+MCVER}function setTurn(e){"black"==e?(BSCBD.classList.remove("turn"),WSCBD.classList.add("turn")):"white"==e&&(BSCBD.classList.add("turn"),WSCBD.classList.remove("turn"))}function selectPiece(e,t){if(e.getAttribute("data-ptyp")!==CTURN)return sendMessage("Cannot select an opponent's piece!","warning"),!1;for(i=0;i<PCELM.length;i++)PCELM[i].classList.contains("selected")&&PCELM[i].getAttribute("data-pcid")!==t.toString()?(PCELM[i].classList.remove("selected"),SELPC=" "):PCELM[i].getAttribute("data-pcid")!=t.toString()||e.classList.contains("selected")?PCELM[i].getAttribute("data-pcid")==t.toString()&&e.classList.contains("selected")&&(e.classList.remove("selected"),SELPC=" "):(e.classList.add("selected"),SELPC=e)}function checkEnd(){return 0==WTPCS?(WINBR.classList.add("visible"),WINBR.innerHTML="BLACK WINS!",sendMessage("Black wins with a final score of "+BLKPT,"info"),endClock(),GMEND=!0,playSound("res/snd/Win.ogg",1),!0):0==BLPCS&&(WINBR.classList.add("visible"),WINBR.innerHTML="WHITE WINS!",sendMessage("White wins with a final score of "+WHTPT,"info"),endClock(),GMEND=!0,playSound("res/snd/Win.ogg",1),!0)}function givePoints(e,t,i){return checkEnd(),"white"==e?(WHTPT+=1,--BLPCS,WHTSC.innerHTML+='<div class="piece black"></div>',sendMessage("White has taken Black's piece at grid "+i+t,"info")):"black"==e&&(BLKPT+=1,--WTPCS,BLKSC.innerHTML+='<div class="piece white"></div>',sendMessage("Black has taken White's piece at grid "+i+t,"info")),!0}function checkPiece(e,t,i){if(checkEnd(),null==e||t<0)return!1;var n=8*(8-(ALPHA.indexOf(e)+1))+parseInt(t)-1;if(1<=GRIDS[n].children.length){var a=GRIDS[n].children[0].getAttribute("data-ptyp"),r=GRIDS[n].children[0].getAttribute("data-isking");return a==CTURN?!1:"black"==a||"white"==a?"false"==i&&"false"==r||"true"==i&&"false"==r||"true"==i&&"true"==r?(sendMessage(CTURN+" moved piece at "+OLDPARENT.attributes[0].nodeValue+OLDPARENT.attributes[1].nodeValue+" to grid "+target.attributes[0].nodeValue+target.attributes[1].nodeValue,"update"),GRIDS[n].children[0].remove(),GRIDS[n].classList.remove("active"),givePoints("black"==a?"white":"black",t,e),playSound("res/snd/Clack.ogg",1),!0):("false"!=i||"true"!=r)&&void 0:void 0}return 0!=GRIDS[n].children.length&&void 0}function checkMove(e,t,i,n,a,r){checkEnd();var s=ALPHA.indexOf(n)-ALPHA.indexOf(t),d=parseInt(i)-parseInt(e),o=window.getComputedStyle(r).getPropertyValue("background-image"),r=a.children[0].getAttribute("data-ptyp"),a=a.children[0].getAttribute("data-isking"),t=ALPHA[parseInt(ALPHA.indexOf(n)+ALPHA.indexOf(t))/2],i=(parseInt(e)+parseInt(i))/2;if(Math.abs(s)==Math.abs(d))return!(2<Math.abs(s)&&2<Math.abs(d))&&(!(Math.abs(s)<1||Math.abs(d)<1)&&(!o.includes("GridWhite.png")&&(!("black"==r&&"false"==a&&s<0)&&(!("white"==r&&"false"==a&&0<s)&&(1==Math.abs(s)&&1==Math.abs(d)?(sendMessage(CTURN+" moved piece at "+OLDPARENT.attributes[0].nodeValue+OLDPARENT.attributes[1].nodeValue+" to grid "+target.attributes[0].nodeValue+target.attributes[1].nodeValue,"update"),playSound("res/snd/Clack.ogg",1),!0):checkPiece(t,i,a))))))}function kingPiece(e,t){e.getAttribute("data-pcid")==t&&"false"==e.getAttribute("data-isking")&&(playSound("res/snd/King.ogg",1),e.setAttribute("data-isking","true"),sendMessage(CTURN.toUpperCase()+" kinged piece at grid "+e.parentNode.getAttribute("data-row")+e.parentNode.getAttribute("data-col"),"update"))}function restart(){console.clear(),BOARD.innerHTML="",CTURN="black",GMEND=!1,BSCBD.classList.add("turn"),WSCBD.classList.remove("turn"),BLKSC.innerHTML="",WHTSC.innerHTML="",WINBR.classList.remove("visible"),WINBR.innerHTML="",PCIDS=[],PCELM=[],SELPC="",BLKPT=0,WHTPT=0,BLPCS=12,WTPCS=12,MESSG.innerHTML="",endClock(),CLOCK.innerHTML="--:--",MCHTM="00:00",firstMove=!1,init(),sendMessage("Restarted game","info")}function exportEvents(){const e=new Date;let t="";for(i=0;i<MESSG.children.length;i++)t+=("["+MESSG.children[i].className.toUpperCase()+"] ").padEnd(10," ")+MESSG.children[i].getAttribute("data-ts")+": "+MESSG.children[i].innerHTML+"\n";var n,a,r="MiniCheckers Events List - "+e.getFullYear().toString()+MNTHS[e.getUTCMonth()]+e.getUTCDate().toString().padStart(2,"0")+"T"+e.getUTCHours().toString().padStart(2,"0")+e.getUTCMinutes().toString().padStart(2,"0")+e.getUTCSeconds().toString().padStart(2,"0")+" UTC.txt",s=new Blob([t],{type:"text/plain"});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(s,r):(n=document.createElement("a"),a=URL.createObjectURL(s),n.href=a,n.download=r,document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(a)},0))}function startClock(){CLOCK.innerHTML="00:00";var t=Date.now(),i=0;stopwatch=setInterval(function(){var e=Date.now()-t,e=Math.floor(e/1e3);e%60==0&&(t=Date.now(),i+=1),CLOCK.innerHTML=i.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0"),60<=e&&(CLOCK.innerHTML=i.toString().padStart(2,"0")+":00"),"99:59"==CLOCK.innerHTML&&endClock(),MCHTM=CLOCK.innerHTML},1e3)}function endClock(){clearInterval(stopwatch),sendMessage("Match over! Final time: "+MCHTM,"info")}function saveGame(){const e=new Date;var t,i,n=BOARD.innerHTML,a=MESSG.innerHTML,a=JSON.stringify({PCIDS:PCIDS,CTURN:CTURN,BLKPT:BLKPT,WHTPT:WHTPT,BLPCS:BLPCS,WTPCS:WTPCS,GMEND:GMEND,EVENTS:a,HTML:n}),n="MiniCheckers Save Game - "+e.getFullYear().toString()+MNTHS[e.getUTCMonth()]+e.getUTCDate().toString().padStart(2,"0")+"T"+e.getUTCHours().toString().padStart(2,"0")+e.getUTCMinutes().toString().padStart(2,"0")+e.getUTCSeconds().toString().padStart(2,"0")+" UTC.json",a=new Blob([a],{type:"application/json"});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(a,n):(t=document.createElement("a"),i=URL.createObjectURL(a),t.href=i,t.download=n,document.body.appendChild(t),t.click(),setTimeout(function(){document.body.removeChild(t),window.URL.revokeObjectURL(i)},0))}function loadGame(e){let t=new FileReader;e=e.files[0];let n;t.readAsText(e),t.onload=function(){for(n=JSON.parse(t.result),restart(),PCIDS=n.PCIDS,CTURN=n.CTURN,setTurn(n.CTURN),BLKSC.innerHTML="",WHTSC.innerHTML="",i=0;i<n.BLKPT;i++)BLKSC.innerHTML+='<div class="piece white"></div>';for(i=0;i<n.WHTPT;i++)WHTSC.innerHTML+='<div class="piece black"></div>';BLPCS=n.BLPCS,WTPCS=n.WTPCS,GMEND=n.GMEND,MESSG.innerHTML=n.EVENTS,BOARD.innerHTML=n.HTML},t.onerror=function(){console.log(t.error)}}function setPoints(e,t){if("black"==e)for(i=0;i<t;i++)BLKSC.innerHTML+='<div class="piece white"></div>';else if("white"==e)for(i=0;i<t;i++)WHTSC.innerHTML+='<div class="piece black"></div>'}BOARD.addEventListener("click",function(e){OLDPARENT=SELPC.parentNode,e=e||window.event,target=e.target,"GRID"==target.tagName&&" "!==SELPC&&(1==checkMove(OLDPARENT.attributes[1].nodeValue,OLDPARENT.attributes[0].nodeValue,target.attributes[1].nodeValue,target.attributes[0].nodeValue,OLDPARENT,target)&&0==GMEND?(firstMove||(firstMove=!0,startClock()),target.classList.add("active"),OLDPARENT.classList.remove("active"),SELPC.classList.remove("selected"),target.appendChild(SELPC),("H"==target.attributes[0].nodeValue&&"black"==CTURN||"A"==target.attributes[0].nodeValue&&"white"==CTURN)&&kingPiece(SELPC,SELPC.attributes[1].nodeValue),"black"==CTURN?(setTurn(CTURN),CTURN="white"):"white"==CTURN&&(setTurn(CTURN),CTURN="black"),checkEnd(),GMEND||sendMessage("It's "+CTURN+"'s turn!","update"),SELPC=" "):sendMessage("Invalid movement for "+CTURN,"warning"))},!1),window.addEventListener("DOMContentLoaded",function(){init(),sendMessage("Welcome to version "+MCVER+" of MiniCheckers!","info")});

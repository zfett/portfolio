const e="1.1.1",n=document.getElementById("event-container"),t=document.getElementsByTagName("board-container")[0],l=document.getElementsByTagName("grid"),a=document.getElementsByClassName("scoreboard")[0],r=document.getElementsByClassName("scoreboard")[1],d=document.getElementById("black-scoreboard"),s=document.getElementById("white-scoreboard"),o=document.getElementById("win-banner"),c=["A","B","C","D","E","F","G","H","I","J"],u=["1","2","3","4","5","6","7","8","9","10"],g=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],p=document.getElementById("match-time");let b="00:00",h=[],f,M="black",v=" ",k=0,m=0,w=12,L=12,T=!1,y=!1,S;document.querySelectorAll("grid.active");let C,H;function playSound(e,t){e=new Audio(e);null!==t&&(e.volume=t),e.play()}function sendMessage(e,t){const i=new Date;var a=i.getFullYear().toString()+" "+g[i.getUTCMonth()]+" "+i.getUTCDate().toString().padStart(2,"0")+" "+i.getUTCHours().toString().padStart(2,"0")+":"+i.getUTCMinutes().toString().padStart(2,"0")+":"+i.getUTCSeconds().toString().padStart(2,"0")+" UTC";switch(t){case"error":case"warning":case"info":case"update":n.innerHTML+='<event data-ts="'+a+'" class="'+t+'">'+e.toUpperCase()+"</event>";break;default:n.innerHTML+='<event data-ts="'+a+'">'+e.toUpperCase()+"</event>"}n.scrollTop=n.scrollHeight}function init(){1==function initBoard(){for(i=0;i<=64;i++)0<i&&i<=8?t.innerHTML+='<grid data-row="'+c[7]+'" data-col="'+u[i-1]+'" title="Grid '+c[7]+u[i-1]+'"></grid>':8<i&&i<=16?t.innerHTML+='<grid data-row="'+c[6]+'" data-col="'+u[i-9]+'" title="Grid '+c[6]+u[i-9]+'"></grid>':16<i&&i<=24?t.innerHTML+='<grid data-row="'+c[5]+'" data-col="'+u[i-17]+'" title="Grid '+c[5]+u[i-17]+'"></grid>':24<i&&i<=32?t.innerHTML+='<grid data-row="'+c[4]+'" data-col="'+u[i-25]+'" title="Grid '+c[4]+u[i-25]+'"></grid>':32<i&&i<=40?t.innerHTML+='<grid data-row="'+c[3]+'" data-col="'+u[i-33]+'" title="Grid '+c[3]+u[i-33]+'"></grid>':40<i&&i<=48?t.innerHTML+='<grid data-row="'+c[2]+'" data-col="'+u[i-41]+'" title="Grid '+c[2]+u[i-41]+'"></grid>':48<i&&i<=56?t.innerHTML+='<grid data-row="'+c[1]+'" data-col="'+u[i-49]+'" title="Grid '+c[1]+u[i-49]+'"></grid>':56<i&&i<=64&&(t.innerHTML+='<grid data-row="'+c[0]+'" data-col="'+u[i-57]+'" title="Grid '+c[0]+u[i-57]+'"></grid>');return console.info("Board layout initialized"),!0}()&&(function initPieces(){for(i=0;i<=l.length-1;i++){var e=l[i].attributes[0].nodeValue,t=parseInt(l[i].attributes[1].nodeValue);"H"==e&&t%2==0||"G"==e&&t%2!=0||"F"==e&&t%2==0?(l[i].innerHTML+='<piece data-ptyp="white" data-pcid="'+i+'" data-isking="false">',h.push(i),l[i].classList.add("active")):("A"==e&&t%2!=0||"B"==e&&t%2==0||"C"==e&&t%2!=0)&&(l[i].innerHTML+='<piece data-ptyp="black" data-pcid="'+i+'" data-isking="false">',h.push(i),l[i].classList.add("active"))}for(f=document.getElementsByTagName("piece"),i=0;i<f.length;i++)f[i].setAttribute("onclick","selectPiece(this,this.attributes[1].nodeValue)");console.info("Placed all pieces successfully")}(),playSound("res/snd/Clack.ogg",0),playSound("res/snd/King.ogg",0),playSound("res/snd/Win.ogg",0)),document.getElementById("version").innerHTML="Version "+e}function setTurn(e){"black"==e?(a.classList.remove("turn"),r.classList.add("turn")):"white"==e&&(a.classList.add("turn"),r.classList.remove("turn"))}function checkEnd(){return 0==L?(o.classList.add("visible"),o.innerHTML="BLACK WINS!",sendMessage("Black wins with a final score of "+k,"info"),endClock(),T=!0,playSound("res/snd/Win.ogg",1),1):0==w&&(o.classList.add("visible"),o.innerHTML="WHITE WINS!",sendMessage("White wins with a final score of "+m,"info"),endClock(),T=!0,playSound("res/snd/Win.ogg",1),1)}function givePoints(e,t,i){return checkEnd(),"white"==e?(m+=1,--w,s.innerHTML+='<div class="piece black"></div>',sendMessage("White has taken Black's piece at grid "+i+t,"info")):"black"==e&&(k+=1,--L,d.innerHTML+='<div class="piece white"></div>',sendMessage("Black has taken White's piece at grid "+i+t,"info")),1}function checkMove(e,t,i,a,n,r){checkEnd();var d=c.indexOf(a)-c.indexOf(t),s=parseInt(i)-parseInt(e),o=window.getComputedStyle(r).getPropertyValue("background-image"),r=n.children[0].getAttribute("data-ptyp"),n=n.children[0].getAttribute("data-isking"),t=c[parseInt(c.indexOf(a)+c.indexOf(t))/2],i=(parseInt(e)+parseInt(i))/2;if(Math.abs(d)==Math.abs(s))return!(2<Math.abs(d)&&2<Math.abs(s))&&(!(Math.abs(d)<1||Math.abs(s)<1)&&(!o.includes("GridWhite.png")&&(!("black"==r&&"false"==n&&d<0)&&(!("white"==r&&"false"==n&&0<d)&&(1==Math.abs(d)&&1==Math.abs(s)?(sendMessage(M+" moved piece at "+C.attributes[0].nodeValue+C.attributes[1].nodeValue+" to grid "+H.attributes[0].nodeValue+H.attributes[1].nodeValue,"update"),playSound("res/snd/Clack.ogg",1),!0):function checkPiece(e,t,i){if(checkEnd(),null==e||t<0)return!1;var a=8*(8-(c.indexOf(e)+1))+parseInt(t)-1;if(1<=l[a].children.length){var n=l[a].children[0].getAttribute("data-ptyp"),r=l[a].children[0].getAttribute("data-isking");return n==M?!1:"black"==n||"white"==n?"false"==i&&"false"==r||"true"==i&&"false"==r||"true"==i&&"true"==r?(sendMessage(M+" moved piece at "+C.attributes[0].nodeValue+C.attributes[1].nodeValue+" to grid "+H.attributes[0].nodeValue+H.attributes[1].nodeValue,"update"),l[a].children[0].remove(),l[a].classList.remove("active"),givePoints("black"==n?"white":"black",t,e),playSound("res/snd/Clack.ogg",1),!0):("false"!=i||"true"!=r)&&void 0:void 0}return 0!=l[a].children.length&&void 0}(t,i,n))))))}function kingPiece(e,t){e.getAttribute("data-pcid")==t&&"false"==e.getAttribute("data-isking")&&(playSound("res/snd/King.ogg",1),e.setAttribute("data-isking","true"),sendMessage(M.toUpperCase()+" kinged piece at grid "+e.parentNode.getAttribute("data-row")+e.parentNode.getAttribute("data-col"),"update"))}function endClock(){clearInterval(S),sendMessage("Match over! Final time: "+b,"info")}t.addEventListener("click",function(e){C=v.parentNode,e=e||window.event,H=e.target,"GRID"==H.tagName&&" "!==v&&(1==checkMove(C.attributes[1].nodeValue,C.attributes[0].nodeValue,H.attributes[1].nodeValue,H.attributes[0].nodeValue,C,H)&&0==T?(y||(y=!0,function startClock(){p.innerHTML="00:00";var t=Date.now(),i=0;S=setInterval(function(){var e=Date.now()-t,e=Math.floor(e/1e3);e%60==0&&(t=Date.now(),i+=1),p.innerHTML=i.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0"),60<=e&&(p.innerHTML=i.toString().padStart(2,"0")+":00"),"99:59"==p.innerHTML&&endClock(),b=p.innerHTML},1e3)}()),H.classList.add("active"),C.classList.remove("active"),v.classList.remove("selected"),H.appendChild(v),("H"==H.attributes[0].nodeValue&&"black"==M||"A"==H.attributes[0].nodeValue&&"white"==M)&&kingPiece(v,v.attributes[1].nodeValue),"black"==M?(setTurn(M),M="white"):"white"==M&&(setTurn(M),M="black"),checkEnd(),T||sendMessage("It's "+M+"'s turn!","update"),v=" "):sendMessage("Invalid movement for "+M,"warning"))},!1),window.addEventListener("DOMContentLoaded",function(){init(),sendMessage("Welcome to version "+e+" of MiniCheckers!","info")});